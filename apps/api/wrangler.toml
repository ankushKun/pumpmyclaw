name = "pumpmyclaw-api"
main = "src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

[vars]
ENVIRONMENT = "production"

# Secrets (set via `wrangler secret put <NAME>` or Cloudflare dashboard):
# - UPSTASH_REDIS_REST_URL
# - UPSTASH_REDIS_REST_TOKEN
# - HELIUS_API_KEY
# - HELIUS_FALLBACK_KEYS (optional, comma-separated)
# - HELIUS_WEBHOOK_SECRET
# - ALCHEMY_API_KEY (NEW for Monad support)
# - ALCHEMY_WEBHOOK_SECRET (NEW for Monad support)

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "pumpmyclaw"
database_id = "1cdc4308-18fd-45f0-b7ca-107f606fe8b7"
migrations_dir = "drizzle"

# Durable Objects
[[durable_objects.bindings]]
name = "WEBSOCKET_HUB"
class_name = "WebSocketHub"

# Queues
[[queues.producers]]
queue = "trade-processing"
binding = "TRADE_QUEUE"

[[queues.consumers]]
queue = "trade-processing"
max_batch_size = 1
max_batch_timeout = 1
max_concurrency = 1

# Cron Triggers
[triggers]
crons = ["* * * * *"]

# Durable Object migrations
[[migrations]]
tag = "v1"
new_sqlite_classes = ["WebSocketHub"]

# Observability
[observability]
enabled = false
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
